name: Update Statistics from Private Repos

on:
  schedule:
    - cron: '0 0 * * *' # Menjalankan setiap hari pada tengah malam UTC
  workflow_dispatch: # Memungkinkan eksekusi manual

jobs:
  update-cards:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. GENERATE STATISTIK CARD (Dengan Private Repo)
      - name: Generate GitHub Stats Card
        uses: lowlighter/metrics@latest
        with:
          # Token yang memiliki izin 'repo' untuk membaca data private
          token: ${{ secrets.PRIVATE_REPO_TOKEN }} 
          
          # Pengaturan Output File & Plugin
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          template: classic
          output_action: none # Kami akan menggunakan commit manual di bawah
          filename: github-metrics.svg

      # 2. GENERATE TOP LANGUAGES CARD (Dengan Private Repo)
      - name: Generate Top Languages Card
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          
          # Pengaturan Output File & Plugin
          template: classic
          output_action: none
          filename: github-top-langs.svg
          base: "" # Tidak menampilkan statistik dasar di kartu ini
          plugin_languages: yes
          plugin_languages_threshold: 0%
          plugin_languages_limit: 10
          plugin_languages_skipped: "HTML, CSS, Shell, Roff, YAML, Other" # Abaikan bahasa markup

      # 3. MENGGANTI KONTEN README
      - name: Replace Content in README
        run: |
          # Dapatkan data SVG yang dihasilkan
          STATS_SVG=$(cat github-metrics.svg)
          LANGS_SVG=$(cat github-top-langs.svg)
          
          # Ganti placeholder di README.md
          sed -i '//,//c\\n<img src="https://raw.githubusercontent.com/${{ github.repository }}/main/github-metrics.svg" alt="GitHub Stats" width="100%">\n' README.md
          sed -i '//,//c\\n<img src="https://raw.githubusercontent.com/${{ github.repository }}/main/github-top-langs.svg" alt="Top Languages" width="100%">\n' README.md

      # 4. COMMIT PERUBAHAN KE REPO
      - name: Commit Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automatic: Update GitHub metrics (Private Repo Included)"
