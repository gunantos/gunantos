name: Update Statistics from Private Repos

on:
  schedule:
    # Menjalankan setiap hari pada tengah malam UTC
    - cron: '0 0 * * *' 
  workflow_dispatch: # Memungkinkan eksekusi manual (untuk pengujian)

jobs:
  update-cards:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Token default GitHub Actions memerlukan izin tulis
    steps:
      - uses: actions/checkout@v4

      # 1. GENERATE STATISTIK CARD UTAMA (Metrics)
      - name: Generate Main GitHub Metrics (Stats, Habits, Stars)
        uses: lowlighter/metrics@latest
        with:
          # TOKEN WAJIB DIBACA DARI REPO SECRETS
          token: ${{ secrets.PRIVATE_REPO_TOKEN }} 
          
          # --- Pengaturan Dasar ---
          user: ${{ github.repository_owner }} # Tambahkan ini agar tool tahu user mana yang diukur
          template: terminal 
          output_action: none # Jangan mengkomit di sini
          filename: github-metrics.svg 
          
          # Tambahkan afiliasi untuk akses repositori privat
          repositories_affiliations: owner, collaborator, organization_member

          # --- PLUGINS UTAMA (Koreksi Sintaks) ---
          base: header, activity, community 
          
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year 
          
          plugin_stargazers: yes
          # plugin_stargazers_limit: 5 <-- Hapus, karena ini bukan parameter yang valid
          
          plugin_habits: yes
          plugin_habits_from: 200 
          plugin_habits_charts: yes
          
          # plugin_noteworthy: yes <-- Hapus atau ganti, ini tidak lagi didukung secara langsung
          plugin_followup: yes
          plugin_followup_sections: repositories, user 
          
          # plugin_traffic: yes <-- Hapus, karena plugin traffic membutuhkan token khusus dan sering menyebabkan error
          # plugin_traffic_sections: views, clones <-- Hapus
          
      # 2. GENERATE TOP LANGUAGES CARD
      - name: Generate Top Languages Card
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          
          # --- Pengaturan Dasar ---
          user: ${{ github.repository_owner }}
          template: terminal
          output_action: none
          filename: github-top-langs.svg 
          base: "" 
          repositories_affiliations: owner, collaborator, organization_member # Wajib untuk privat repo

          # --- PLUGINS BAHASA ---
          plugin_languages: yes
          plugin_languages_threshold: 0%
          plugin_languages_limit: 10
          plugin_languages_skipped: "HTML, CSS, Shell, Roff, YAML, Other" 
          
      # 3. COMMIT PERUBAHAN KE REPO (Menggunakan Token GitHub Default yang aman)
      - name: Commit Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: "*.svg" # File yang di commit
          commit_message: "docs: update GitHub metrics and cards"
          # Tambahkan ini untuk menggunakan token yang memiliki izin commit di repo
          commit_user_name: 'github-actions[bot]'
          commit_user_email: 'github-actions[bot]@users.noreply.github.com'
