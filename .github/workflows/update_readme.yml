name: Update Statistics from Private Repos

on:
  schedule:
    # Menjalankan setiap hari pada tengah malam UTC
    - cron: '0 0 * * *' 
  workflow_dispatch: # Memungkinkan eksekusi manual (untuk pengujian)

jobs:
  update-cards:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. GENERATE STATISTIK CARD UTAMA (Metrics)
      - name: Generate Main GitHub Metrics (Stats, Habits, Stars)
        uses: lowlighter/metrics@latest
        with:
          # TOKEN WAJIB DIBACA DARI REPO SECRETS
          token: ${{ secrets.PRIVATE_REPO_TOKEN }} 
          
          # Pengaturan Tampilan & File
          template: terminal # Template yang modern dan gelap
          output_action: none 
          filename: github-metrics.svg # Output file

          # PLUGINS UTAMA UNTUK DAYA TARIK
          base: header, activity, community # Tampilkan Header, Aktivitas, dan Komunitas
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year # Tampilkan kalender kontribusi
          
          plugin_stargazers: yes
          plugin_stargazers_limit: 5 # Tampilkan 5 repo yang paling banyak di-star

          plugin_habits: yes
          plugin_habits_from: 200 # Analisis 200 event terakhir
          plugin_habits_charts: yes # Tampilkan grafik waktu coding
          
          plugin_noteworthy: yes # Soroti kontribusi paling menonjol
          plugin_followup: yes
          plugin_followup_sections: repositories, user # Tampilkan issue/PR di repo Anda dan yang perlu Anda tindak lanjuti
          plugin_traffic: yes
          plugin_traffic_sections: views, clones # Tampilkan views dan clones
          
      # 2. GENERATE TOP LANGUAGES CARD
      - name: Generate Top Languages Card
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          
          # Pengaturan Tampilan & File
          template: terminal
          output_action: none
          filename: github-top-langs.svg # Output file
          base: "" # Jangan tampilkan statistik dasar di kartu ini

          # PLUGINS BAHASA
          plugin_languages: yes
          plugin_languages_threshold: 0%
          plugin_languages_limit: 10
          plugin_languages_skipped: "HTML, CSS, Shell, Roff, YAML, Other" # Abaikan bahasa markup
          
      # 3. COMMIT PERUBAHAN KE REPO (Menggunakan Token GitHub Default yang aman)
      - name: Commit Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: "*.svg"
          commit_message: "docs: update GitHub metrics and cards"
          # File github-metrics.svg dan github-top-langs.svg akan dikomit
