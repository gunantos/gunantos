name: Update Statistics from Private Repos

on:
  schedule:
    - cron: '0 0 * * *' 
  workflow_dispatch: 

jobs:
  update-cards:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. GENERATE STATISTIK CARD UTAMA (github-metrics.svg)
      - name: Generate Main GitHub Metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }} 
          template: terminal 
          # PENTING: Ubah output_action dari 'none' menjadi 'directory'
          output_action: directory
          filename: github-metrics.svg
          base: header, activity, community 
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          plugin_stargazers: yes
          plugin_habits: yes
          plugin_habits_from: 200 
          plugin_habits_charts: yes 
          
      # 2. GENERATE TOP LANGUAGES CARD (github-top-langs.svg)
      - name: Generate Top Languages Card
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          template: terminal
          # PENTING: Ubah output_action dari 'none' menjadi 'directory'
          output_action: directory
          filename: github-top-langs.svg
          base: "" 
          plugin_languages: yes
          plugin_languages_threshold: 0%
          plugin_languages_limit: 10
          plugin_languages_skipped: "HTML, CSS, Shell, Roff, YAML, Other"
          
      # 3. HILANGKAN LANGKAH COPY MANUAL!
      # Menggunakan output_action: directory (di langkah 1 & 2) 
      # akan menyimpan file di direktori kerja, sehingga langkah copy tidak diperlukan.

      # 4. COMMIT PERUBAHAN KE REPO
      - name: Commit Files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automatic: Update GitHub metrics (Private Repo Included)"
          # File github-metrics.svg dan github-top-langs.svg akan dikomit
